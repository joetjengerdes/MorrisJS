<!DOCTYPE html>
<html>

<head>
   <meta charset="utf-8">
   <title>Mühle-Spiel</title>
   <script src="assets/js/PlayerToken.js"></script>
   <script src="assets/js/Player.js"></script>
   <script src="assets/js/Game.js"></script>
   <script src="assets/js/GameField.js"></script>
   <script src="assets/js/Vertex.js"></script>
   <script src="assets/js/GameStatusBar.js"></script>
   <script src="assets/js/EventController.js"></script>
   <script src="assets/js/GameController.js"></script>
   <script src="assets/js/DrawController.js"></script>
   <script src="assets/js/SoundController.js"></script>
   <script src="assets/js/services/SizeCalculationService.js"></script>
   <script src="assets/js/services/GameProblemSolver.js"></script>
   <script src="assets/js/GamebarDrawer.js"></script>
   <script src="assets/js/services/ArtificialIntelligenceService.js"></script>
   <link href="assets/css/style.css" rel="stylesheet" type="text/css">
   <!--Import Google Icon Font-->
   <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <!-- Compiled and minified CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
   <!-- Compiled and minified JavaScript -->
   <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
   <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
   <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
   <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
   <link rel="manifest" href="manifest.json">
   <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
   <meta name="theme-color" content="#ffffff">
</head>

<body onload>
   <div id="wrapper">

      <nav id="topnav">
         <div class="nav-wrapper teal">
            <a href="#" class="brand-logo">Nine Men's Morris Online</a>
            <ul id="nav-right" class="right hide-on-med-and-down">
               <li class="music">
                  <!-- Switch -->
                  <div class="switch">
                     <label>
                        Music Off
                        <input id="myonoffswitch" type="checkbox" checked>
                        <span class="lever"></span> Music On
                     </label>
                  </div>
               </li>
               <li>
                  <a id="menutoggle" href="javascript:void(0)">
                     <i class="material-icons">menu</i>
                  </a>
               </li>
            </ul>
         </div>
      </nav>

      <!--
      <p class="all"> Game started!</p>
      <p class="player1">Place a token!</p>
      <p class="player1"><img src="assets/img/player.png">Placed token!</p>
      <p clasS="player2"><img src="assets/img/cpu.png"></img>Test123</p>
      </div>-->
      <div id="sidebar">
         <div id="sidebar-inner">

         </div>
      </div>

      <div id="gamefield">
         <canvas id="game" width="600" height="600" tabindex="1">
            <h1>To play this game Javascript must be activated!</h1>
         </canvas>

         <div class="fixed-action-btn" style="bottom: 120px; right: 24px;">
            <a id="newGameBtn" class="btn-floating btn-large red tooltipped" data-position="left" data-delay="50" data-tooltip="Start a new game!">
               <i class="large material-icons">replay</i>
            </a>
         </div>

         <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
            <a href="#infomodal" id="infoBtn" class="btn-floating btn-large blue modal-trigger tooltipped" data-position="left" data-delay="50" data-tooltip="Instructions and CCs are hidden here!">
               <i class="large material-icons">info</i>
            </a>
         </div>
      </div>

      <div id="statusbox">
         &copy; Jannis Ötjengerdes & Timo Stüber
      </div>


      <!-- Modal Structure -->
      <div id="settingsModal" class="modal modal-fixed-footer">
         <div class="modal-content">

            <h5>Welcome!</h5> To play this game, please select a username first.
            <br />

            <div class="input-field">
               <input id="username" type="text" autocomplete="off" value="Mr. Test" class="validate valid">
               <label for="username">Username</label>
            </div>

            <span id="inputError" class="error"></span>
            <br /> And select a difficulty
            <form action="#">
               <p>
                  <input class="with-gap" name="group1" type="radio" id="test1" />
                  <label for="test1">Easy</label>
               </p>
               <p>
                  <input class="with-gap" name="group1" type="radio" id="test2" checked/>
                  <label for="test2">Middle</label>
               </p>
               <p>
                  <input class="with-gap" name="group1" type="radio" id="test3" />
                  <label for="test3">Hard</label>
               </p>
            </form>
            <br />
            <a id="settingsConfirmBtn" class="waves-effect waves-light btn">Start game!</a>
         </div>
      </div>


      <!-- Modal Structure -->
      <div id="infomodal" class="modal modal-fixed-footer">
         <div class="modal-content">
            <h3>Information</h3> This game was developed by
            <ul>
               <li>Jannis Ötjengerdes</li>
               <li>Timo Stüber</li>
            </ul>
            for a code competition of <a href="https://www.it-talents.de/foerderung/code-competition/code-competition-07-2016">it-talents.de</a>
            <h4>Game rules</h4> The board consists of a grid with twenty-four intersections or points. Each player has nine pieces, or "men", usually coloured black and white. Players try to form 'mills'—three of their own men lined horizontally or vertically—allowing a
            player to remove an opponent's man from the game. A player wins by reducing the opponent to two pieces (where he could no longer form mills and thus be unable to win), or by leaving him without a legal move. The game proceeds in three phases:
            <ul>
               <li>Placing men on vacant points</li>
               <li>Moving men to adjacent points (optional phase)</li>
               <li>Moving men to any vacant point when a player has been reduced to three men</li>
               <h5>Phase 1: Placing pieces</h5> Nine Men's Morris starts on an empty board. The game begins with an empty board. The players determine who plays first, then take turns placing their men one per play on empty points. If a player is able to place three of his pieces in
               a straight line, vertically or horizontally, he has formed a mill and may remove one of his opponent's pieces from the board and the game. Any piece can be chosen for the removal, but a piece not in an opponent's mill must be selected,
               if possible.
               <h5>Phase 2: Moving pieces</h5> Players continue to alternate moves, this time moving a man to an adjacent point. A piece may not "jump" another piece. Players continue to try to form mills and remove their opponent's pieces in the same manner as in phase one. A player
               may "break" a mill by moving one of his pieces out of an existing mill, then moving the piece back to form the same mill a second time (or any number of times), each time removing one of his opponent's men. The act of removing an opponent's
               man is sometimes called "pounding" the opponent. When one player has been reduced to three men, phase three begins.
               <h5>Phase 3: "Flying"</h5> When a player is reduced to three pieces, there is no longer a limitation on that player of moving to only adjacent points: The player's men may "fly", "hop",[4][5] or "jump"[6] from any point to any vacant point. Some rules sources say
               this is the way the game is played,[5][6] some treat it as a variation,[4][7][8][9] and some don't mention it at all.[10] A 19th-century games manual calls this the "truly rustic mode of playing the game".[4] Flying was introduced to compensate
               when the weaker side is one man away from losing the game.
               <h4>Copyrights</h4>
               <h5>Icons</h5>
               <div>Icons made by <a href="http://www.flaticon.com/authors/roundicons" title="Roundicons">Roundicons</a> from <a href="http://www.flaticon.com" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/"
                      title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
               <h5>Sounds</h5>
               <ul>
                  <li><a href="http://soundbible.com/1705-Click2.html">Sebastian</a></li>
                  <li><a href="http://soundbible.com/1294-Button-Click-Off.html">Mike Koenig</a></li>
               </ul>
               <h5>Music</h5> Music from Jukedeck - create your own at <a href="http://jukedeck.com">http://jukedeck.com.</a>


         </div>
         <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-teal btn-flat ">Okay!</a>
         </div>
      </div>

   </div>

   <audio id="songplayer" autoplay loop>
      <source src="assets/music/bg.mp3" type="audio/mpeg" />
   </audio>

   <audio id="click">
      <source src="assets/sounds/click.mp3" type="audio/mpeg" />
   </audio>

   <audio id="clickoff">
      <source src="assets/sounds/click-off.mp3" type="audio/mpeg" />
   </audio>

   <script>
      var musicOn;
      var menuOpen = false;
      var modalDisplayed = false;

      $(document).ready(function(event) {

         $('.modal-trigger').leanModal();
         $('#settingsModal').openModal();


         musicOn = readCookie("musicOn");
         console.log(musicOn);

         doMusicControls();



         var canvas = document.getElementById('game');

         canvas.width = document.body.clientWidth; //document.width is obsolete
         canvas.height = Math.max(window.innerHeight, document.body.clientHeight);

         var p1 = new Player('Mr. Test');
         //console.log(p1.isVisible());
         var gameStatusBar = new GameStatusBar();
         var gbDrawer = new GamebarDrawer(gameStatusBar);
         var game = new Game(gameStatusBar, p1);




         var eventController = new EventController(canvas, game.getGamefield());
         var controller = new GameController(game, gameStatusBar);
         eventController.setGameController(controller);


         var drawController = new DrawController(canvas, game.getGamefield());

         eventController.setDrawController(drawController);

         controller.setDrawController(drawController);

         doValidation();
         doStartButtons();

         $('#newGameBtn').click(function() {
            $('#newGameBtn').addClass('disabled');
            game.newGame();
            drawController.redraw(true);
            setTimeout(function() {
               $('#newGameBtn').removeClass('disabled');
            }, 2000);
         });

         $('#menutoggle').click(function() {

            if (!menuOpen) {
               openNav();
            } else {
               closeNav();
            }

            // timeout needed for css transition time
            setTimeout(function() {
               eventController.getSizeCalculationService().calculate();
               drawController.redraw(true);
            }, 500);
         });

      });

      function doValidation() {
         $('#username').keyup(function() {
            if ($(this).val().trim().length > 3) {
               $(this).removeClass('invalid');
               $(this).addClass('valid');
               $('#inputError').html('')
               $('#settingsConfirmBtn').removeClass('disabled');
            } else {
               $(this).removeClass('valid');
               $(this).addClass('invalid');
               $('#inputError').html('username too short!')
               $('#settingsConfirmBtn').addClass('disabled');
            }
         });
      }

      function doStartButtons() {
         $('#newGameBtn').click(function() {
            $('#newGameBtn').addClass('disabled');
            game.newGame();
            drawController.redraw(true);
            setTimeout(function() {
               $('#newGameBtn').removeClass('disabled');
            }, 2000);
         });

         $('#settingsConfirmBtn').click(function() {
            // TODO: save difficulty
            $('#settingsModal').closeModal();
         });
      }


      /* Set the width of the side navigation to 250px */
      function openNav() {
         $('#statusbox').width($('#game').width() - 250);
         $('#sidebar').width("250px");
         $('#nav-right').css('padding-right', '250px');
         $('#infoBtn').css('margin-right', '250px');
         $('#newGameBtn').css('margin-right', '250px');

         menuOpen = true;
      }

      /* Set the width of the side navigation to 0 */
      function closeNav() {
         $('#statusbox').width($('#game').width() + 250);
         $('#sidebar').width('0');
         $('#nav-right').css('padding-right', '0');
         $('#infoBtn').css('margin-right', '24px');
         $('#newGameBtn').css('margin-right', '24px');

         menuOpen = false;
      }

      function doMusicControls() {
         var musicSwitch = $('#myonoffswitch');
         var songplayer = $('#songplayer');

         if (!musicOn) {
            songplayer.trigger('pause');
            musicSwitch.prop('checked', false);
         }

         musicSwitch.change(function(e) {
            musicOn = !musicOn;
            if (musicOn) {
               songplayer.trigger('play');
            } else {
               songplayer.trigger('pause');
            }
            writeCookie("musicOn", musicOn);
         });
      };

      function readCookie(key) {
         if (document.cookie) {
            var start = document.cookie.indexOf(key + "=") + key.length + 1;
            var end = document.cookie.indexOf(",");
            if (end == -1) {
               end = document.cookie.length;
            }
            return document.cookie.substring(start, end) == "true" ? true : false;
         }
         return true;
      }

      function writeCookie(key, value) {
         var expireDate = new Date(new Date() + 1000 * 60 * 60 * 24 * 365);
         document.cookie = key + "=" + value + ", expires=" +
            expireDate.toGMTString() + "; path=/";
      }
   </script>
</body>

</html>
